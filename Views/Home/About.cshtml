@model HW_03.Models.HomePageViewModel
@{
    ViewBag.Title = "Maintain";
}
<link href="~/Content/Theme.css" rel="stylesheet" />
<div class="container-fluid mt-4">
    <h2 class="text-center mb-4 fw-bold">🛠 Maintain</h2>

    <div class="row justify-content-between">

        <!-- ================= STAFF SECTION ================= -->
        <div class="col-md-4 bg-light border rounded-3 p-3 shadow-sm">
            <div class="d-flex justify-content-between align-items-center mb-2">
                <h5 class="fw-bold">Staff</h5>
            </div>

            <!-- Staff Dropdown -->
            <form method="get" action="@Url.Action("About", "Home")">
                <select name="selectedStaffId" class="form-select mb-2" onchange="this.form.submit()">
                    @foreach (var s in Model.StaffList)
                    {
                        <option value="@s.staff_id" @(s.staff_id == ViewBag.SelectedStaffId ? "selected" : "")>
                            @s.first_name @s.last_name
                        </option>
                    }
                </select>
            </form>

            @if (Model.StaffList != null && Model.StaffList.Any())
            {
                var s = Model.StaffList.FirstOrDefault(st => st.staff_id == ViewBag.SelectedStaffId);
                if (s != null)
                {
                    <div class="mb-2">
                        <label class="fw-semibold">First Name</label>
                        <input type="text" class="form-control mb-2" value="@s.first_name" readonly />
                        <label class="fw-semibold">Last Name</label>
                        <input type="text" class="form-control mb-2" value="@s.last_name" readonly />
                        <label class="fw-semibold">Staff ID</label>
                        <input type="text" class="form-control mb-2" value="@s.staff_id" readonly />

                        <div class="border p-2 bg-white rounded mt-2" style="min-height:80px;">
                            @if (s.orders != null && s.orders.Any())
                            {
                                foreach (var order in s.orders)
                                {
                                    foreach (var item in order.order_items)
                                    {
                                        <div>• Sold @item.products.product_name</div>
                                    }
                                }
                            }
                            else
                            {
                                <span>No sales</span>
                            }
                        </div>

                        <div class="d-flex gap-2 mt-2">
                            
                            <a href="@Url.Action("Edit", "staffs", new { id = s.staff_id })" class="btn btn-primary btn-sm">Edit</a>
                            <a href="@Url.Action("Delete", "staffs", new { id = s.staff_id })" class="btn btn-danger btn-sm">Delete</a>
                        </div>
                    </div>
                }
            }
        </div>

        <!-- ================= CUSTOMERS SECTION ================= -->
        <div class="col-md-4 bg-light border rounded-3 p-3 shadow-sm">
            <div class="d-flex justify-content-between align-items-center mb-2">
                <h5 class="fw-bold">Customers</h5>
            </div>

            <!-- Customer Dropdown -->
            <form method="get" action="@Url.Action("About", "Home")">
                <select name="selectedCustomerId" class="form-select mb-2" onchange="this.form.submit()">
                    @foreach (var c in Model.CustomerList)
                    {
                        <option value="@c.customer_id" @(c.customer_id == ViewBag.SelectedCustomerId ? "selected" : "")>
                            @c.first_name @c.last_name
                        </option>
                    }
                </select>
            </form>

            @if (Model.CustomerList != null && Model.CustomerList.Any())
            {
                var c = Model.CustomerList.FirstOrDefault(cust => cust.customer_id == ViewBag.SelectedCustomerId);
                if (c != null)
                {
                    <div class="mb-2">
                        <label class="fw-semibold">First Name</label>
                        <input type="text" class="form-control mb-2" value="@c.first_name" readonly />
                        <label class="fw-semibold">Last Name</label>
                        <input type="text" class="form-control mb-2" value="@c.last_name" readonly />
                        <label class="fw-semibold">Customer ID</label>
                        <input type="text" class="form-control mb-2" value="@c.customer_id" readonly />

                        <div class="border p-2 bg-white rounded mt-2" style="min-height:80px;">
                            @if (c.orders != null && c.orders.Any())
                            {
                                foreach (var order in c.orders)
                                {
                                    foreach (var item in order.order_items)
                                    {
                                        <div>• Purchased @item.products.product_name</div>
                                    }
                                }
                            }
                            else
                            {
                                <span>No purchases</span>
                            }
                        </div>

                        <div class="d-flex gap-2 mt-2">
                           
                            <a href="@Url.Action("Edit", "customers", new { id = c.customer_id })" class="btn btn-primary btn-sm">Edit</a>
                            <a href="@Url.Action("Delete", "customers", new { id = c.customer_id })" class="btn btn-danger btn-sm">Delete</a>
                        </div>
                    </div>
                }
            }
        </div>

        <!-- ================= PRODUCTS SECTION ================= -->

        <div class="col-md-3 bg-light border rounded-3 p-3 shadow-sm">
            <div class="d-flex justify-content-between align-items-center mb-2">
                <h5 class="fw-bold">Products</h5>

            </div>

            <!-- Product Dropdown -->
            <form method="get" action="@Url.Action("About", "Home")">
                <select name="selectedProductId" class="form-select mb-2" onchange="this.form.submit()">
                    @foreach (var p in Model.ProductList)
                    {
                        <option value="@p.product_id" @(p.product_id == ViewBag.SelectedProductId ? "selected" : "")>
                            @p.product_name
                        </option>
                    }
                </select>
            </form>


            @if (Model.ProductList != null && Model.ProductList.Any())
            {
                var p = Model.ProductList.FirstOrDefault(prod => prod.product_id == ViewBag.SelectedProductId);
                if (p != null)
                {
                    string imageFile = "default_bike.jpeg";
                    string brand = p.brands.brand_name.ToLower();
                    string category = p.categories.category_name.ToLower();

                    // Image selection
                    if (category.Contains("cruiser") && (brand.Contains("electra") || brand.Contains("ritchey") || brand.Contains("haro") || brand.Contains("pure")))
                    {
                        imageFile = "Electra_cruiser.jpeg";
                    }
                    else if (category.Contains("cruiser") && (brand.Contains("strider") || brand.Contains("trek") || brand.Contains("sun") || brand.Contains("surly") || brand.Contains("heller")))
                    {
                        imageFile = "Electra_cruiser 1.jpeg";
                    }
                    else if (category.Contains("comfort") && (brand.Contains("electra") || brand.Contains("ritchey") || brand.Contains("haro") || brand.Contains("pure")))
                    {
                        imageFile = "Sun_Bicycles1.jpeg";
                    }
                    else if (category.Contains("comfort") && (brand.Contains("strider") || brand.Contains("trek") || brand.Contains("sun") || brand.Contains("surly") || brand.Contains("heller")))
                    {
                        imageFile = "Haro_Bikes1.jpeg";
                    }
                    else if (category.Contains("cyclocross") && (brand.Contains("electra") || brand.Contains("ritchey") || brand.Contains("haro") || brand.Contains("pure")))
                    {
                        imageFile = "Pure_Cycles1.jpeg";
                    }
                    else if (category.Contains("cyclocross") && (brand.Contains("strider") || brand.Contains("trek") || brand.Contains("sun") || brand.Contains("surly") || brand.Contains("heller")))
                    {
                        imageFile = "Pure_Cycles2.jpeg";
                    }
                    else if (category.Contains("electric") && (brand.Contains("electra") || brand.Contains("ritchey") || brand.Contains("haro") || brand.Contains("pure")))
                    {
                        imageFile = "Riychey_bike1.jpeg";
                    }
                    else if (category.Contains("electric") && (brand.Contains("strider") || brand.Contains("trek") || brand.Contains("sun") || brand.Contains("surly") || brand.Contains("heller")))
                    {
                        imageFile = "Ritchey_bike2.jpeg";
                    }
                    else if (category.Contains("mountain") && (brand.Contains("electra") || brand.Contains("ritchey") || brand.Contains("haro") || brand.Contains("pure")))
                    {
                        imageFile = "Haro_mountain_bike.jpeg";
                    }
                    else if (category.Contains("mountain") && (brand.Contains("strider") || brand.Contains("trek") || brand.Contains("sun") || brand.Contains("surly") || brand.Contains("heller")))
                    {
                        imageFile = "Heller_bike1.jpeg";
                    }
                    else if (category.Contains("road") && (brand.Contains("electra") || brand.Contains("ritchey") || brand.Contains("haro") || brand.Contains("pure")))
                    {
                        imageFile = "Surly_bike.jpeg";
                    }
                    else if (category.Contains("road") && (brand.Contains("strider") || brand.Contains("trek") || brand.Contains("sun") || brand.Contains("surly") || brand.Contains("heller")))
                    {
                        imageFile = "Surly_preamble_bike.jpeg";
                    }
                    else if (category.Contains("child") && (brand.Contains("electra") || brand.Contains("ritchey") || brand.Contains("haro") || brand.Contains("pure")))
                    {
                        imageFile = "ChildrensBike1.jpg";
                    }
                    else if (category.Contains("child") && brand.Contains("strider"))
                    {
                        imageFile = "Strider_balance_bike1.jpeg";
                    }
                    else if (category.Contains("child") && (brand.Contains("strider") || brand.Contains("trek") || brand.Contains("sun") || brand.Contains("surly") || brand.Contains("heller")))
                    {
                        imageFile = "ChildrensBike2.jpg";
                    }

                    <div class="mb-2">
                        <label class="fw-semibold">Product Name</label>
                        <input type="text" class="form-control mb-2" value="@p.product_name" readonly />
                        <label class="fw-semibold">Brand</label>
                        <input type="text" class="form-control mb-2" value="@p.brands.brand_name" readonly />
                        <label class="fw-semibold">Category</label>
                        <input type="text" class="form-control mb-2" value="@p.categories.category_name" readonly />
                        <label class="fw-semibold">Price</label>
                        <input type="text" class="form-control mb-2" value="@String.Format("{0:C}", p.list_price)" readonly />

                        <!-- ===== IMAGE SECTION ===== -->
                        <div class="border mt-2 text-center p-2">
                            <img src="~/content/images/@imageFile" class="img-fluid" alt="@p.product_name" />
                        </div>

                        <div class="d-flex gap-2 mt-2">
                           
                            <a href="@Url.Action("Edit", "products", new { id = p.product_id })" class="btn btn-primary btn-sm">Edit</a>
                            <a href="@Url.Action("Delete", "products", new { id = p.product_id })" class="btn btn-danger btn-sm">Delete</a>
                        </div>
                    </div>
                }
            }
        </div>

    </div>
</div>
